Index: libiberty/cp-demangle.c
===================================================================
--- libiberty/cp-demangle.c	(revision 235760)
+++ libiberty/cp-demangle.c	(working copy)
@@ -5387,6 +5387,24 @@ d_print_comp (struct d_print_info *dpi, int option
 {
   struct d_component_stack self;
 
+  self.parent = dpi->component_stack;
+
+  while (self.parent)
+    {
+      self.dc = self.parent->dc;
+      self.parent = self.parent->parent;
+      if (dc != NULL && self.dc == dc)
+	{
+	  while (self.parent)
+	    {
+	      self.dc = self.parent->dc;
+	      self.parent = self.parent->parent;
+	      if (self.dc == dc)
+	        return;
+	    }
+	}
+    }
+
   self.dc = dc;
   self.parent = dpi->component_stack;
   dpi->component_stack = &self;
